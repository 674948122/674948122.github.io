import{_ as n,Q as s,a2 as a,a4 as p}from"./framework-a091056b.js";const e="/assets/images/1735744ec7df59f3.png",i="/assets/images/1735746db1170442.png",t={},o=p(`<h1 id="gzip压缩" tabindex="-1"><a class="header-anchor" href="#gzip压缩" aria-hidden="true">#</a> gzip压缩</h1><h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言" aria-hidden="true">#</a> 前言</h2><ul><li><p>很多Vue项目，都有一个通病，随着代码越来越庞大，首页加载越来越慢，有时候出去演示，网络不好的时候，转半天，登录页面还没有出来。这主要是一些大的js文件造成的，这就是Vue的缺点吧，所有的代码都打包到一个JS文件里，网络传输太慢，有的项目都十几兆。</p></li><li><p>gzip的本质，是在build的时候打包两份代码，一份压缩的，一份未压缩的，然后nginx在接收请求时，优先选择压缩后的格式返给客户端。</p></li><li><p>使用gzip进行压缩，可以压缩js和css文件大小，提升加载速度。</p></li></ul><h2 id="前端代码配置" tabindex="-1"><a class="header-anchor" href="#前端代码配置" aria-hidden="true">#</a> 前端代码配置</h2><ol><li><p>下载代码压缩插件，运行命令<code>npm i compression-webpack-plugin@1.1.2</code></p></li><li><p>写入压缩配置，如下</p></li></ol><p><code>build/webpack.prod.conf.js</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>productionGzip<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> CompressionWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;compression-webpack-plugin&#39;</span><span class="token punctuation">)</span>

  webpackConfig<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">CompressionWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;[path].gz[query]&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">algorithm</span><span class="token operator">:</span> <span class="token string">&#39;gzip&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>
        <span class="token string">&#39;\\\\.(&#39;</span> <span class="token operator">+</span>
        config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>productionGzipExtensions<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;|&#39;</span><span class="token punctuation">)</span> <span class="token operator">+</span>
        <span class="token string">&#39;)$&#39;</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">threshold</span><span class="token operator">:</span> <span class="token number">10240</span><span class="token punctuation">,</span>
      <span class="token literal-property property">minRatio</span><span class="token operator">:</span> <span class="token number">0.8</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>config/index.js</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
 <span class="token literal-property property">build</span><span class="token operator">:</span><span class="token punctuation">{</span>
  <span class="token literal-property property">productionGzip</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">productionGzipExtensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;js&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;css&#39;</span><span class="token punctuation">]</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>tips: <code>config/index.js</code>文件中的<code>productionGzip</code>变量起到了快捷开关压缩功能的作用,<code>productionGzipExtensions</code>用来规定需要压缩的文件类型。</p><h2 id="nginx服务器配置" tabindex="-1"><a class="header-anchor" href="#nginx服务器配置" aria-hidden="true">#</a> nginx服务器配置</h2><ol><li>修改nginx服务器配置，开启服务器的gzip功能，向<code>nginx.conf</code>文件中写入配置，如下</li></ol><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>http <span class="token punctuation">{</span>
 gzip  on<span class="token punctuation">;</span>
 gzip_min_length  1k<span class="token punctuation">;</span> # 不压缩临界值，大于1K的才压缩
 gzip_buffers     <span class="token number">4</span> 16k<span class="token punctuation">;</span>
 gzip_http_version <span class="token number">1.1</span><span class="token punctuation">;</span>
 gzip_comp_level <span class="token number">2</span><span class="token punctuation">;</span>
 gzip_types     text<span class="token operator">/</span>plain application<span class="token operator">/</span>javascript application<span class="token operator">/</span>x<span class="token operator">-</span>javascript text<span class="token operator">/</span>javascript text<span class="token operator">/</span>css application<span class="token operator">/</span>xml application<span class="token operator">/</span>xml<span class="token operator">+</span>rss<span class="token punctuation">;</span> # #进行压缩的文件类型
 gzip_vary on<span class="token punctuation">;</span>
 gzip_proxied   expired no<span class="token operator">-</span>cache no<span class="token operator">-</span>store <span class="token keyword">private</span> auth<span class="token punctuation">;</span>
 gzip_disable   <span class="token string">&quot;MSIE [1-6]\\.&quot;</span><span class="token punctuation">;</span>
 
 server <span class="token punctuation">{</span>
  <span class="token operator">...</span>一些常规内容
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>tips: 以上配置书写位置在<code>server</code>之前即可。</p><ol start="2"><li>重启nginx服务器，以便让上面的配置生效<code>nginx -s reload</code></li></ol><h2 id="效果分析" tabindex="-1"><a class="header-anchor" href="#效果分析" aria-hidden="true">#</a> 效果分析</h2><figure><img src="`+e+'" alt="图片" tabindex="0" loading="lazy"><figcaption>图片</figcaption></figure><p>通常<code>gzip</code>压缩可以减小文件大小<code>70%</code>以上，效果还是比较显著的，在相同网络状况下，首屏加载时间可以加快<code>40%</code>以上，大幅提升加载速度，增强用户体验。</p><figure><img src="'+i+'" alt="图片" tabindex="0" loading="lazy"><figcaption>图片</figcaption></figure><p>如果gzip开启成功，在请求响应头中会看到gzip相关字样，并且size会相应变小。</p>',20),c=[o];function l(r,u){return s(),a("div",null,c)}const k=n(t,[["render",l],["__file","gzip压缩.html.vue"]]);export{k as default};
